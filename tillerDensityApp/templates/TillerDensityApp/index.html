<!DOCTYPE html>
<html>
<head>
  <title>{{ page_title }}</title>
  {% load static %}
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.css" />
  <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/smoothness/jquery-ui.css" />
  <link rel="stylesheet" href="{% static 'css/app.css' %}?v=20260209g">
  <meta name="csrf-token" content="{{ csrf_token }}">
</head>
<body>
  <div class="app-shell">
    <aside class="left-rail">
      <div class="brand-block">
        <div class="brand-logo-wrap">
          <img
            class="brand-logo"
            src="{% static 'img/tiller-logo.png' %}"
            alt="Tiller Density Logo"
            onerror="this.style.display='none';"
          />
        </div>
        <h1>{{ brand_title }}</h1>
      </div>

      <div class="rail-actions">
        <div class="rail-date-card">
          <label for="date-input">Date of Inspection</label>
          <input type="date" id="date-input" />
        </div>
        <button id="tiller-density-button" class="rail-button rail-button-primary" disabled>
          <span class="rail-button-title">Generate Tiller Density Map</span>
          <span class="rail-button-sub">Run inference and visualize density</span>
        </button>
        <button id="report-button" class="rail-button rail-button-primary" disabled>
          <span class="rail-button-title">Generate Report</span>
          <span class="rail-button-sub">Summary stats and classified views</span>
        </button>
        <button id="nutrient-prescription-button" class="rail-button" disabled>
          <span class="rail-button-title">Nutrient Prescription</span>
          <span class="rail-button-sub">Coming soon</span>
        </button>
      </div>

      <!-- <div class="rail-hint">
        Draw AOI on the map, select a date, then generate.
      </div> -->

      <div class="rail-footer">
        <button id="sign-in-button" type="button" class="rail-footer-button rail-footer-signin">Sign in</button>
        <button id="user-guide-button" type="button" class="rail-footer-button">User guide</button>
        <button id="about-us-button" type="button" class="rail-footer-button">About us</button>
        <button id="contact-us-button" type="button" class="rail-footer-button">Contact us</button>
      </div>
    </aside>

    <main class="map-stage">
      <div id="map"></div>

      <section id="tiller-density-map" class="result-panel result-panel-map">
        <div class="panel-header">
          <h3>Tiller Density Map</h3>
          <div class="panel-actions">
            <button type="button" class="panel-minimize" data-panel="tiller-density-map" aria-label="Minimize panel">-</button>
            <button type="button" class="panel-close" data-panel="tiller-density-map" aria-label="Close panel">x</button>
          </div>
        </div>
        <div id="tiller-density-map-content"></div>
      </section>

      <section id="report-container" class="result-panel result-panel-report">
        <div class="panel-header">
          <h3>Wheat Monitoring Report</h3>
          <div class="panel-actions">
            <button type="button" id="report-download-button" class="panel-download" aria-label="Download report as PDF">PDF</button>
            <button type="button" class="panel-minimize" data-panel="report-container" aria-label="Minimize panel">-</button>
            <button type="button" class="panel-close" data-panel="report-container" aria-label="Close panel">x</button>
          </div>
        </div>
        <div id="report-content"></div>
      </section>

      <div id="minimized-dock" class="minimized-dock"></div>
    </main>
  </div>

  <div class="toast"></div>

  <div id="about-modal" class="info-modal" aria-hidden="true" role="dialog" aria-labelledby="about-modal-title">
    <div class="info-modal-card" role="document">
      <button id="about-modal-close" type="button" class="info-modal-close" aria-label="Close About us dialog">x</button>
      <h2 id="about-modal-title">About Wheat-TDM v1</h2>
      <p>
        Wheat-TDM (Version 1.0) is a cloud-based digital tool designed to support timely, within-field
        wheat tiller density mapping at 30 m spatial resolution during the tillering to jointing growth
        stages. The platform automatically generates maps for user-selected wheat fields or regions using
        satellite imagery and AI-based models.
      </p>
      <p>
        Wheat-TDM is a collaborative effort between the Remote Sensing &amp; Agricultural Intelligence (RSAI)
        Lab (PI: Dr. Maitiniyazi Maimaitijiang, Assistant Professor) and the Winter Wheat Breeding and
        Innovation Lab (PI: Dr. Sunish Kumar Sehgal, Professor) at South Dakota State University, with
        important contributions from PhD student Santosh Subedi.
      </p>
      <p>
        Development of Wheat-TDM Version 1.0 has been primarily supported by the South Dakota Wheat
        Commission, along with the South Dakota State University Challenge Fund Program, and the
        Sustainable Agriculture Research and Education (SARE) program.
      </p>
    </div>
  </div>

  <div id="guide-modal" class="info-modal" aria-hidden="true" role="dialog" aria-labelledby="guide-modal-title">
    <div class="info-modal-card guide-modal-card" role="document">
      <button id="guide-modal-close" type="button" class="info-modal-close" aria-label="Close User guide dialog">x</button>
      <h2 id="guide-modal-title">User Guide</h2>
      <p class="guide-intro">
        Follow this quick workflow to run the app from start to finish.
      </p>
      <div class="guide-flow">
        <section class="guide-step">
          <div class="guide-step-num">1</div>
          <div class="guide-step-body">
            <h3>Draw AOI</h3>
            <p>Use the draw tools on the map and create one polygon around your field boundary.</p>
          </div>
        </section>
        <section class="guide-step">
          <div class="guide-step-num">2</div>
          <div class="guide-step-body">
            <h3>Select Date</h3>
            <p>Pick the field inspection date from <strong>Date of Inspection</strong> on the left panel.</p>
          </div>
        </section>
        <section class="guide-step">
          <div class="guide-step-num">3</div>
          <div class="guide-step-body">
            <h3>Generate Tiller Density Map</h3>
            <p>Click <strong>Generate Tiller Density Map</strong> and wait for the raster layer to render.</p>
          </div>
        </section>
        <section class="guide-step">
          <div class="guide-step-num">4</div>
          <div class="guide-step-body">
            <h3>Generate Report</h3>
            <p>Click <strong>Generate Report</strong> to open summary KPIs and classified map outputs.</p>
          </div>
        </section>
      </div>
      <div class="guide-tips">
        <h4>Quick Tips</h4>
        <ul>
          <li>Draw one clean AOI at a time for best results.</li>
          <li>If buttons are disabled, confirm both AOI and date are selected.</li>
          <li>Use panel minimize/close controls to keep the map workspace clear.</li>
        </ul>
      </div>
    </div>
  </div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/geotiff@2.0.4/dist-browser/geotiff.js"></script>
  <script src="https://unpkg.com/georaster"></script>
  <script src="https://unpkg.com/georaster-layer-for-leaflet"></script>
  <script src="https://unpkg.com/chroma-js@2.4.2/chroma.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@turf/turf@6/turf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="{% static 'js/app.js' %}?v=20260211c"></script>
</body>
</html>
